<div class="col-md-4 col-12 card-stacked">
   <div class="card shadow-line mb-3 chat">
      <div class="chat-user-detail">
         <div class="p-3 chat-header">
            <div class="w-100">
               <div class="d-flex pl-0">
                  <div class="d-flex flex-row mt-1 mb-1">
                     <span class="margin-auto mr-2">
                        <a
                           href="#"
                           class="user-undetail-trigger btn btn-sm btn-icon btn-light active text-dark ml-2"
                        >
                           <svg
                              viewBox="0 0 24 24"
                              width="18"
                              height="18"
                              stroke="currentColor"
                              stroke-width="2"
                              fill="none"
                              stroke-linecap="round"
                              stroke-linejoin="round"
                              class="feather"
                           >
                              <polyline points="15 18 9 12 15 6"></polyline>
                           </svg>
                        </a>
                     </span>
                     <p class="margin-auto fw-400 text-dark-75">Profile</p>
                  </div>
                  <div></div>
               </div>
            </div>
         </div>
         <div class="p-3 chat-user-info">
            <div class="card-body text-center">
               <a href="#!">
                  <img
                     src="../images/<%= user.profilePicture %>"
                     class="rounded-circle img-fluid shadow avatar-xxl"
                  />
               </a>
               <div class="pt-4 text-center animate4">
                  <h6 class="fw-300 mb-1"><%= user.username %></h6>
                  <p class="text-muted">Web Developer</p>
                  <div class="mt-4">
                     <a
                        href="#"
                        class="btn btn-light-skype btn-icon btn-circle btn-sm btn-shadow mr-2"
                        ><i class="bx bxl-skype"></i
                     ></a>
                     <a
                        href="#"
                        class="btn btn-light-facebook btn-icon btn-circle btn-sm btn-shadow mr-2"
                        ><i class="bx bxl-facebook"></i
                     ></a>
                     <a
                        href="#"
                        class="btn btn-light-twitter btn-icon btn-circle btn-sm btn-shadow mr-2"
                        ><i class="bx bxl-twitter"></i
                     ></a>
                     <a
                        href="#"
                        class="btn btn-light-instagram btn-icon btn-circle btn-sm btn-shadow mr-2"
                        ><i class="bx bxl-instagram"></i
                     ></a>
                     <a
                        href="/logout"
                        class="btn btn-light-instagram btn-icon btn-circle btn-sm btn-shadow mr-2"
                     >
                        <i class="las la-sign-out-alt"></i>
                     </a>
                  </div>
               </div>
            </div>
         </div>
      </div>
      <div class="p-3 chat-header">
         <div class="d-flex">
            <div class="w-100 d-flex pl-0">
               <img
                  class="user-detail-trigger rounded-circle shadow avatar-sm mr-3 chat-profile-picture"
                  src="../images/<%= user.profilePicture %>"
               />
            </div>
            <div class="flex-shrink-0 margin-auto">
               <a
                  href="#"
                  class="btn btn-sm btn-icon btn-light active text-dark ml-2"
               >
                  <svg
                     viewBox="0 0 24 24"
                     width="15"
                     height="15"
                     stroke="currentColor"
                     stroke-width="2"
                     fill="none"
                     stroke-linecap="round"
                     stroke-linejoin="round"
                     class="feather"
                  >
                     <rect
                        x="2"
                        y="7"
                        width="20"
                        height="15"
                        rx="2"
                        ry="2"
                     ></rect>
                     <polyline points="17 2 12 7 7 2"></polyline>
                  </svg>
               </a>
               <button
                  data-toggle="modal"
                  data-target="#exampleModalCenter"
                  class="btn btn-sm btn-icon btn-light active text-dark ml-2"
               >
                  <svg
                     viewBox="0 0 24 24"
                     width="15"
                     height="15"
                     stroke="currentColor"
                     stroke-width="2"
                     fill="none"
                     stroke-linecap="round"
                     stroke-linejoin="round"
                     class="feather"
                  >
                     <path d="M12 20h9"></path>
                     <path
                        d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"
                     ></path>
                  </svg>
               </button>
               <a
                  href="#"
                  class="btn btn-sm btn-icon btn-light active text-dark ml-2"
               >
                  <svg
                     viewBox="0 0 24 24"
                     width="15"
                     height="15"
                     stroke="currentColor"
                     stroke-width="2"
                     fill="none"
                     stroke-linecap="round"
                     stroke-linejoin="round"
                     class="feather"
                  >
                     <circle cx="12" cy="12" r="1"></circle>
                     <circle cx="12" cy="5" r="1"></circle>
                     <circle cx="12" cy="19" r="1"></circle>
                  </svg>
               </a>
            </div>
         </div>
      </div>
      <div class="chat-search pl-3 pr-3">
         <div class="input-group">
            <input
               type="text"
               class="form-control"
               placeholder="Search a conversation"
            />
            <div class="input-group-append prepend-white">
               <span class="input-group-text pl-2 pr-2">
                  <i class="fs-17 las la-search drop-shadow"></i>
               </span>
            </div>
         </div>
      </div>
      <div class="archived-messages d-flex p-3">
         <div class="w-100">
            <div class="d-flex pl-0">
               <div class="d-flex flex-row mt-1">
                  <span class="margin-auto mr-2">
                     <div class="svg15 archived"></div>
                  </span>
                  <p class="margin-auto fw-400 text-dark-75">Archived</p>
               </div>
               <div></div>
            </div>
         </div>
      </div>
      <div class="chat-user-panel" id="chat-user-panel">
         <div class="pb-3 d-flex flex-column chat-user-scroll" id="chat-user">
            <% if(conversations.length > 0) {
            conversations.forEach((conversation,i) => { let lastMessage =
            conversation.lastMessage.message; if(lastMessage?.length > 10) {
            lastMessage = lastMessage.substr(0,10)+"..." } %>
            <div class="position-relative conversation-container">
               <a
                  class="chat-item <%= i === 0 ? 'active' : '' %> d-flex pl-3 pr-0 pt-3 pb-3"
                  href="/conversation/<%= conversation._id %>"
               >
                  <div class="w-100">
                     <div class="d-flex pl-0 h-100">
                        <% if(conversation.members.length > 2) { %>
                        <div class="mr-3 position-relative group-avatar">
                           <div class="avatar">
                              <img
                                 src="../images/<%= conversation.members[0].profilePicture %>"
                                 alt="User 1"
                              />
                           </div>
                           <div class="avatar">
                              <img
                                 src="../images/<%= conversation.members[1].profilePicture %>"
                                 alt="User 2"
                              />
                           </div>
                           <div class="avatar">
                              <img
                                 src="../images/<%= conversation.members[2].profilePicture %>"
                                 alt="User 3"
                              />
                           </div>
                        </div>
                        <div>
                           <p class="margin-auto fw-400 text-dark-75">
                              <%= conversation.name %>
                           </p>
                           <div class="d-flex flex-row mt-1">
                              <span
                                 class="message-shortcut margin-auto fw-400 fs-13 mr-4"
                                 ><%= lastMessage %></span
                              >
                           </div>
                        </div>
                        <% } else { const otherMember =
                        conversation.members.filter(member => member._id !=
                        user._id) %>
                        <div class="mr-3 position-relative group-avatar">
                           <img
                              class="rounded-circle shadow avatar-sm"
                              src="../images/<%= otherMember[0].profilePicture %>"
                           />
                           <div
                              class="online-indicator <%= otherMember[0].isOnline == 1 ? 'active' : '' %>"
                              id="<%= otherMember[0]._id %>_status"
                           ></div>
                        </div>
                        <div>
                           <p class="margin-auto fw-400 text-dark-75">
                              <%= otherMember[0].username %>
                           </p>
                           <div class="d-flex flex-row mt-1">
                              <span
                                 class="message-shortcut margin-auto fw-400 fs-13 mr-4"
                                 ><%= lastMessage %></span
                              >
                           </div>
                        </div>
                        <% } %>
                     </div>
                  </div>
                  <div class="flex-shrink-0 margin-auto pl-2 pr-3">
                     <div class="d-flex flex-column">
                        <p class="text-muted text-right fs-13 mb-2">08:21</p>
                        <span
                           class="round badge badge-light-success margin-auto"
                           >2</span
                        >
                     </div>
                  </div>
               </a>
               <div
                  class="chat-option"
                  data-toggle="modal"
                  data-target="#exampleModal"
                  data-conversation-id="<%= conversation._id %>"
               >
                  <i class="las la-trash-alt"></i>
               </div>
            </div>
            <% }) } %>
         </div>
      </div>
   </div>
</div>
